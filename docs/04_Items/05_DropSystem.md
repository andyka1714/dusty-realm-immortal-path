# 物品掉落與品質系統 (Drop & Quality System)

本文檔定義遊戲中的物品掉落機率、品質分佈以及屬性生成邏輯。

## 1. 掉落機制概覽

遊戲中的掉落分為兩個階段：
1.  **掉落判定 (Roll for Drop)**: 決定是否掉落物品。
2.  **品質判定 (Roll for Quality)**: 如果掉落裝備，決定其品質（下/中/上/仙）。

---

## 2. 掉落機率 (Drop Rates)

不同階級的敵人擁有不同的基礎掉落機率與品質權重。

| 敵人階級 (Rank) | 掉落判定 (Drop Chance) | 品質權重 (Quality Weights) |
| :--- | :--- | :--- |
| **小怪 (Common)** | **10%** (1 件) | 🟢 下品: 85% <br> 🔵 中品: 14% <br> 🟣 上品: 1% |
| **精英 (Elite)** | **35%** (1~3 件) | 🟢 下品: 50% <br> 🔵 中品: 40% <br> 🟣 上品: 9% <br> 🟠 仙品: 1% |
| **首領 (Boss)** | **100%** (3~4 件) | 🔵 中品: 30% <br> 🟣 上品: 60% <br> 🟠 仙品: 10% |

> **設計備註**: Boss 必定掉落，且是獲取上品與仙品裝備的主要途徑。精英怪則是刷中品裝備的穩定來源。

---

## 3. 品質與詞條系統 (Quality & Affixes)

裝備的最終屬性由 **基礎屬性** 乘以 **品質倍率**，再加上 **隨機詞條** 組成。

### 3.1 品質倍率 (Multiplier)

| 品質 | 顏色 | 倍率 (Multiplier) | 詞條數 (Affixes) |
| :--- | :--- | :--- | :--- |
| **下品 (Low)** | 灰色 | **1.0x** | 0 |
| **中品 (Medium)** | 綠色 | **1.2x** | 0~1 (低機率) |
| **上品 (High)** | 藍色 | **1.4x** | 1 (必帶) |
| **仙品 (Immortal)** | 金色 | **1.7x** | 2 (必帶，含特殊詞條) |

### 3.2 屬性計算公式
```typescript
FinalStats = (BaseStats * QualityMultiplier) + AffixStats
```
*   例如：基礎攻擊 10 的劍，上品 (1.4x) + 攻擊詞條 (+2)
*   結果：`10 * 1.4 + 2 = 16` 攻擊力。

### 3.3 詞條規則 (Affix Rules)
目前實作的隨機詞條與基礎數值如下 (受品質倍率加成)：

| 詞條 (Prefix) | 屬性 (Attribute) | 基礎值 (Base Value) | 備註 |
| :--- | :--- | :--- | :--- |
| **鋒利** (Sharp) | 攻擊 (Attack) | +3 | |
| **嗜血** (Blood) | 攻擊 (Attack) | +2 | |
| **堅固** (Sturdy)| 防禦 (Defense) | +2 | |
| **寒冰** (Ice) | 防禦 (Defense) | +1 | |
| **輕靈** (Agile) | 速度 (Speed) | +1 | |
| **厚重** (Heavy) | 氣血 (MaxHP) | +30 | |

*   **上品 (High)**: 詞條數值額外提升 1.5 倍
*   **仙品 (Immortal)**: 詞條數值額外提升 2.0 倍

> **未來擴展**: 目前數值針對【凡人期】平衡。隨著境界提升，將引入更高階詞條或改為百分比加成。

---

## 4. 凡人期掉落分佈 (Mortal Realm Drops)

為了鼓勵探索，凡人期的新手套裝分散於不同怪物身上：

### 小怪 (Common) - 掉落率 10%
| 怪物 | 推薦掉落 (主要) | 其他掉落 (次要) |
| :--- | :--- | :--- |
| **尖刺鼠** | `straw_sandals` (草鞋) | `wooden_charm` (平安符) |
| **野狼** | `wooden_shield` (木鍋蓋) | `novice_sword` (鏽鐵劍) |
| **野豬** | `novice_robe` (粗布衣) | `straw_sandals` (草鞋) |
| **棕熊** | `straw_hat` (草帽) | `wooden_shield` (木鍋蓋) |
| **山賊** | `novice_sword` (鏽鐵劍) | `novice_robe` (粗布衣) |

### 精英 (Elite) - 掉落率 35%
*   **所有精英怪** (如石屋守衛) 皆有機會掉落 **全套新手裝備** 中的任意 1~3 件。

### Boss - 掉落率 100%
*   **守塚老屍**: 必定掉落 **全套新手裝備** 中的任意 3~4 件。

---

## 5. 系統實作要求 (Implementation Requirements)

為支援上述設計，系統需具備以下功能：
1.  **實例化背包 (Inventory Instancing)**: 背包需支援存儲具有唯一 ID (`uuid`) 的物品實例，而非僅存儲數量。
2.  **動態屬性生成 (Dynamic Stats)**: 獲得物品時，需即時運算品質與隨機詞條，並寫入實例數據中。
3.  **裝備比較**: 提示介面需能顯示從「背包物品」替換「身上裝備」的數值變化差異。
